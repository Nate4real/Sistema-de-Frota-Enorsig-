<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Custo - EnorFrota</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/cc.css">
</head>

<body>
    <!-- Bot√£o de Modo Dark -->
    <button id="modo-dark-btn" class="modo-dark-btn" onclick="alternarModoDark()">üåô</button>

    <!-- Modal de Edi√ß√£o (mantido caso queira usar depois) -->
    <div id="modal-editar" class="modal" style="display:none;">
        <div class="modal-conteudo">
            <span class="fechar" onclick="fecharModal()">&times;</span>
            <h2>Editar Status do Centro de Custo</h2>
            <form id="form-edicao">
                <div class="form-group">
                    <label for="edit-status">Status</label>
                    <select id="edit-status">
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn salvar" onclick="salvarEdicao()">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Barra lateral -->
    <div class="barra-lateral" id="barra-lateral">
        <h2>EnorFrota</h2>
        <ul>
            <li onclick="window.location.href='home.html';">
                <i class="fas fa-home"></i> In√≠cio
            </li>
            <li onclick="window.location.href='relatorios.html';">
                <i class="fas fa-file-alt"></i> Relat√≥rios
            </li>
            <li onclick="window.location.href='Veiculos.html';">
                <i class="fas fa-car"></i> Ve√≠culos
            </li>
            <li onclick="window.location.href='abastecimento.html';">
                <i class="fas fa-gas-pump"></i> Abastecimento
            </li>
            <li onclick="window.location.href='usuarios-principal.html';">
                <i class="fas fa-users"></i> Usu√°rios
            </li>
            <li class="ativo" onclick="window.location.href='cc.html';">
                <i class="fas fa-dollar-sign"></i> Centro de Custo
            </li>
            <li onclick="window.location.href='base.html';">
                <i class="fas fa-building"></i> Base
            </li>
            <li onclick="window.location.href='cartao_combustivel.html';">
                <i class="fas fa-credit-card"></i> Cart√£o
            </li>
            <li onclick="window.location.href='Frota.index.html';">
                <i class="fas fa-sign-in-alt"></i> Sair
            </li>
            <!-- Exemplo de bot√£o/aba modo escuro na barra lateral -->
            <li class="modo-escuro-aba" onclick="alternarModoEscuro()">
                <i class="fas fa-moon"></i>
                <span>Modo Escuro</span>
            </li>
        </ul>
        <div class="informacoes-usuario">
            <div class="avatar-usuario">
                <img src="img/avatar.jpg" alt="Foto do Usu√°rio">
            </div>
            <p>Nome do Usu√°rio</p>
            <p>Perfil: Administrador</p>
        </div>
    </div>

    <!-- Conte√∫do principal -->
    <div class="conteudo">
        <div class="container">
            <!-- Container de Cadastro -->
            <div class="cadastro-container">
                <h1>Cadastro de Centros de Custo</h1>
                <form id="formNovoCentroCusto" class="form-cadastro">
                    <div class="form-group">
                        <label for="inputIdCentroCusto">C√≥digo</label>
                        <input type="text" id="inputIdCentroCusto" placeholder="Digite o c√≥digo" required>
                    </div>
                    <div class="form-group">
                        <label for="inputNome">Nome</label>
                        <input type="text" id="inputNome" placeholder="Digite o nome" required>
                    </div>
                    <div class="form-group">
                        <label for="inputResponsavel">Respons√°vel</label>
                        <input type="text" id="inputResponsavel" placeholder="Digite o respons√°vel" required>
                    </div>
                    <div class="form-group">
                        <label for="inputStatus">Status</label>
                        <select id="inputStatus" required>
                            <option value="">Selecione o status</option>
                            <option value="Ativo">Ativo</option>
                            <option value="Inativo">Inativo</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="reset" class="btn limpar">Limpar</button>
                        <button type="submit" class="btn salvar">Salvar</button>
                    </div>
                </form>
            </div>

            <!-- Container de Centros de Custo Cadastrados -->
            <div class="cadastrados-container">
                <h2>Centros de Custo Cadastrados</h2>
                <table class="tabela-centros">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>C√≥digo</th>
                            <th>Nome</th>
                            <th>Respons√°vel</th>
                            <th>Status</th>
                            <th>A√ß√µes</th> <!-- Esta coluna √© obrigat√≥ria -->
                        </tr>
                    </thead>
                    <tbody id="tabela-centros-body">
                        <!-- Dados inseridos via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- SCRIPTS: Apenas UM bloco, limpo e funcional -->
    <script>
        // Carrega e exibe os centros de custo na tabela
        function carregarCentrosCusto() {
            fetch('http://localhost:5000/api/centros_custo')
                .then(res => res.json())
                .then(centros => {
                    const tbody = document.getElementById('tabela-centros-body');
                    tbody.innerHTML = '';
                    centros.forEach(centro => {
                        const status = centro.status ? centro.status : 'Indefinido';
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${centro.id}</td>
                            <td>${centro.id_centro_custo}</td>
                            <td>${centro.nome}</td>
                            <td>${centro.responsavel}</td>
                            <td><span class="status-badge ${status.toLowerCase()}">${status}</span></td>
                            <td>
                                <button onclick="toggle     StatusCC(${centro.id}, '${status}')" title="${status === 'Ativo' ? 'Inativar' : 'Ativar'}" style="background:none;border:none;cursor:pointer;">
                                    <i class="fas fa-power-off" style="color:${status === 'Ativo' ? 'green' : 'red'};font-size:1.2em;"></i>
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(err => {
                    alert("Erro ao carregar centros de custo do banco de dados.");
                    console.error(err);
                });
        }

        // Ativa/Inativa o centro de custo
        function toggleStatusCC(id, statusAtual) {
            const novoStatus = statusAtual === 'Ativo' ? 'Inativo' : 'Ativo';
            fetch(`http://localhost:5000/api/centros_custo/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: novoStatus })
            })
            .then(res => {
                if (!res.ok) throw new Error();
                carregarCentrosCusto();
            })
            .catch(err => {
                alert("Erro ao atualizar status.");
                console.error(err);
            });
        }

        // Envia novo centro de custo para o backend
        document.getElementById('formNovoCentroCusto').onsubmit = function(e) {
            e.preventDefault();
            const novoCentro = {
                id_centro_custo: document.getElementById('inputIdCentroCusto').value,
                nome: document.getElementById('inputNome').value,
                responsavel: document.getElementById('inputResponsavel').value,
                status: document.getElementById('inputStatus').value
            };
            fetch('http://localhost:5000/api/centros_custo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(novoCentro)
            })
            .then(res => {
                if (!res.ok) throw new Error();
                carregarCentrosCusto();
                this.reset();
            })
            .catch(err => {
                alert("Erro ao salvar centro de custo.");
                console.error(err);
            });
        }

        // Dark mode (mantido)
        function alternarModoDark() {
            const body = document.body;
            const btn = document.getElementById("modo-dark-btn");
            body.classList.toggle("dark-mode");
            btn.classList.toggle("dark");
        }

        // Modal fun√ß√µes (mantido caso queira usar depois)
        function fecharModal() {
            document.getElementById("modal-editar").style.display = "none";
        }

        document.addEventListener('DOMContentLoaded', carregarCentrosCusto);
    </script>
</body>

</html>
